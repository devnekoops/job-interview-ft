from typing import List, Optional

from fastapi import Depends, FastAPI, HTTPException, Header
import hashlib
from . import schemas
from io import StringIO
import pandas as pd

app = FastAPI()

ohlc_csv = """time,open,high,low,close,volume,change,change_pct,code
2021-12-22 09:00:00,3119.0,3444.0,3119.0,3444.0,255,325.0,10.42,FINA
2021-12-22 09:00:00,3081.0,3181.0,3067.0,3129.0,245,48.0,1.56,FTHD
2021-12-22 09:00:00,3385.0,3455.0,3256.0,3298.0,250,-87.0,-2.57,KZNE
2021-12-22 09:00:00,3537.0,3596.0,3428.0,3481.0,262,-56.0,-1.58,NOWC
2021-12-22 09:00:00,3923.0,4081.0,3875.0,4038.0,260,115.0,2.93,SPCR
2021-12-22 09:00:00,3290.0,3443.0,3245.0,3416.0,237,126.0,3.83,SPLS
2021-12-22 09:00:00,3995.0,4133.0,3901.0,4127.0,248,132.0,3.3,TEQA
2021-12-22 10:00:00,3443.0,3669.0,3440.0,3624.0,242,181.0,5.26,FINA
2021-12-22 10:00:00,3122.0,3177.0,2865.0,2924.0,249,-198.0,-6.34,FTHD
2021-12-22 10:00:00,3283.0,3423.0,3196.0,3415.0,241,132.0,4.02,KZNE
2021-12-22 10:00:00,3475.0,3552.0,3365.0,3505.0,240,30.0,0.86,NOWC
2021-12-22 10:00:00,4033.0,4156.0,4008.0,4035.0,237,2.0,0.05,SPCR
2021-12-22 10:00:00,3411.0,3578.0,3411.0,3539.0,242,128.0,3.75,SPLS
2021-12-22 10:00:00,4112.0,4326.0,4052.0,4066.0,255,-46.0,-1.12,TEQA
2021-12-22 11:00:00,3610.0,3743.0,3594.0,3641.0,243,31.0,0.86,FINA
2021-12-22 11:00:00,2928.0,3021.0,2726.0,2750.0,250,-178.0,-6.08,FTHD
2021-12-22 11:00:00,3411.0,3484.0,3373.0,3483.0,230,72.0,2.11,KZNE
2021-12-22 11:00:00,3500.0,3539.0,3432.0,3450.0,242,-50.0,-1.43,NOWC
2021-12-22 11:00:00,4044.0,4255.0,4044.0,4063.0,236,19.0,0.47,SPCR
2021-12-22 11:00:00,3526.0,3553.0,3298.0,3401.0,250,-125.0,-3.55,SPLS
2021-12-22 11:00:00,4051.0,4087.0,3902.0,4025.0,262,-26.0,-0.64,TEQA
2021-12-22 12:00:00,3633.0,3774.0,3615.0,3633.0,254,0.0,0.0,FINA
2021-12-22 12:00:00,2762.0,2766.0,2563.0,2614.0,236,-148.0,-5.36,FTHD
2021-12-22 12:00:00,3497.0,3536.0,3369.0,3448.0,238,-49.0,-1.4,KZNE
2021-12-22 12:00:00,3448.0,3455.0,3257.0,3362.0,257,-86.0,-2.49,NOWC
2021-12-22 12:00:00,4073.0,4214.0,4054.0,4196.0,258,123.0,3.02,SPCR
2021-12-22 12:00:00,3390.0,3548.0,3339.0,3506.0,233,116.0,3.42,SPLS
2021-12-22 12:00:00,4015.0,4015.0,3831.0,3846.0,243,-169.0,-4.21,TEQA
2021-12-22 13:00:00,3648.0,3726.0,3574.0,3574.0,240,-74.0,-2.03,FINA
2021-12-22 13:00:00,2614.0,2698.0,2554.0,2627.0,248,13.0,0.5,FTHD
2021-12-22 13:00:00,3447.0,3509.0,3343.0,3372.0,251,-75.0,-2.18,KZNE
2021-12-22 13:00:00,3362.0,3388.0,3217.0,3306.0,254,-56.0,-1.67,NOWC
2021-12-22 13:00:00,4182.0,4415.0,4140.0,4398.0,242,216.0,5.16,SPCR
2021-12-22 13:00:00,3520.0,3650.0,3507.0,3613.0,267,93.0,2.64,SPLS
2021-12-22 13:00:00,3836.0,4003.0,3800.0,3976.0,256,140.0,3.65,TEQA
2021-12-22 14:00:00,3577.0,3858.0,3568.0,3783.0,249,206.0,5.76,FINA
2021-12-22 14:00:00,2620.0,2683.0,2543.0,2621.0,239,1.0,0.04,FTHD
2021-12-22 14:00:00,3364.0,3479.0,3289.0,3469.0,226,105.0,3.12,KZNE
2021-12-22 14:00:00,3296.0,3415.0,3201.0,3362.0,255,66.0,2.0,NOWC
2021-12-22 14:00:00,4413.0,4584.0,4410.0,4523.0,258,110.0,2.49,SPCR
2021-12-22 14:00:00,3622.0,3738.0,3562.0,3655.0,240,33.0,0.91,SPLS
2021-12-22 14:00:00,3962.0,4209.0,3942.0,3991.0,241,29.0,0.73,TEQA
2021-12-22 15:00:00,2611.0,2611.0,2611.0,2611.0,1,0.0,0.0,FTHD
2021-12-23 09:00:00,3787.0,3884.0,3574.0,3709.0,240,-78.0,-2.06,FINA
2021-12-23 09:00:00,2597.0,2597.0,2430.0,2462.0,245,-135.0,-5.2,FTHD
2021-12-23 09:00:00,3476.0,3525.0,3338.0,3375.0,248,-101.0,-2.91,KZNE
2021-12-23 09:00:00,3370.0,3381.0,3184.0,3204.0,225,-166.0,-4.93,NOWC
2021-12-23 09:00:00,4524.0,4603.0,4395.0,4565.0,265,41.0,0.91,SPCR
2021-12-23 09:00:00,3651.0,3944.0,3618.0,3876.0,271,225.0,6.16,SPLS
2021-12-23 09:00:00,3999.0,4069.0,3919.0,4048.0,269,49.0,1.23,TEQA
2021-12-23 10:00:00,3714.0,3874.0,3598.0,3832.0,247,118.0,3.18,FINA
2021-12-23 10:00:00,2452.0,2587.0,2398.0,2573.0,252,121.0,4.93,FTHD
2021-12-23 10:00:00,3372.0,3517.0,3294.0,3460.0,266,88.0,2.61,KZNE
2021-12-23 10:00:00,3204.0,3219.0,2957.0,3018.0,239,-186.0,-5.81,NOWC
2021-12-23 10:00:00,4576.0,4635.0,4350.0,4350.0,262,-226.0,-4.94,SPCR
2021-12-23 10:00:00,3874.0,3998.0,3811.0,3994.0,238,120.0,3.1,SPLS
2021-12-23 10:00:00,4044.0,4258.0,4031.0,4233.0,258,189.0,4.67,TEQA
2021-12-23 11:00:00,3846.0,4003.0,3832.0,3946.0,245,100.0,2.6,FINA
2021-12-23 11:00:00,2565.0,2613.0,2456.0,2483.0,258,-82.0,-3.2,FTHD
2021-12-23 11:00:00,3466.0,3550.0,3372.0,3545.0,247,79.0,2.28,KZNE
2021-12-23 11:00:00,3033.0,3211.0,3021.0,3074.0,250,41.0,1.35,NOWC
2021-12-23 11:00:00,4365.0,4640.0,4354.0,4616.0,255,251.0,5.75,SPCR
2021-12-23 11:00:00,4009.0,4127.0,3937.0,4054.0,238,45.0,1.12,SPLS
2021-12-23 11:00:00,4222.0,4360.0,4130.0,4142.0,246,-80.0,-1.89,TEQA
2021-12-23 12:00:00,3951.0,4023.0,3920.0,3945.0,257,-6.0,-0.15,FINA
2021-12-23 12:00:00,2488.0,2489.0,2135.0,2141.0,253,-347.0,-13.95,FTHD
2021-12-23 12:00:00,3552.0,3806.0,3526.0,3676.0,264,124.0,3.49,KZNE
2021-12-23 12:00:00,3069.0,3245.0,3013.0,3102.0,236,33.0,1.08,NOWC
2021-12-23 12:00:00,4627.0,4879.0,4616.0,4715.0,254,88.0,1.9,SPCR
2021-12-23 12:00:00,4050.0,4104.0,3925.0,3974.0,244,-76.0,-1.88,SPLS
2021-12-23 12:00:00,4152.0,4208.0,4004.0,4144.0,259,-8.0,-0.19,TEQA
2021-12-23 13:00:00,3957.0,4109.0,3875.0,3875.0,254,-82.0,-2.07,FINA
2021-12-23 13:00:00,2136.0,2282.0,1998.0,2279.0,254,143.0,6.69,FTHD
2021-12-23 13:00:00,3663.0,3698.0,3540.0,3635.0,257,-28.0,-0.76,KZNE
2021-12-23 13:00:00,3109.0,3153.0,2958.0,3062.0,242,-47.0,-1.51,NOWC
2021-12-23 13:00:00,4704.0,4896.0,4641.0,4892.0,262,188.0,4.0,SPCR
2021-12-23 13:00:00,3980.0,4041.0,3779.0,3801.0,260,-179.0,-4.5,SPLS
2021-12-23 13:00:00,4132.0,4357.0,4064.0,4357.0,241,225.0,5.45,TEQA
2021-12-23 14:00:00,3890.0,3982.0,3822.0,3945.0,241,55.0,1.41,FINA
2021-12-23 14:00:00,2278.0,2323.0,2098.0,2162.0,241,-116.0,-5.09,FTHD
2021-12-23 14:00:00,3637.0,3661.0,3477.0,3611.0,267,-26.0,-0.71,KZNE
2021-12-23 14:00:00,3075.0,3197.0,3045.0,3145.0,249,70.0,2.28,NOWC
2021-12-23 14:00:00,4906.0,5080.0,4809.0,5065.0,270,159.0,3.24,SPCR
2021-12-23 14:00:00,3789.0,4017.0,3789.0,3949.0,240,160.0,4.22,SPLS
2021-12-23 14:00:00,4356.0,4685.0,4350.0,4677.0,262,321.0,7.37,TEQA
2021-12-23 15:00:00,4673.0,4673.0,4673.0,4673.0,1,0.0,0.0,TEQA
2021-12-24 09:00:00,3938.0,4018.0,3858.0,3884.0,238,-54.0,-1.37,FINA
2021-12-24 09:00:00,2157.0,2326.0,2103.0,2179.0,255,22.0,1.02,FTHD
2021-12-24 09:00:00,3621.0,3757.0,3494.0,3512.0,248,-109.0,-3.01,KZNE
2021-12-24 09:00:00,3150.0,3207.0,3000.0,3064.0,259,-86.0,-2.73,NOWC
2021-12-24 09:00:00,5068.0,5126.0,4909.0,5087.0,240,19.0,0.37,SPCR
2021-12-24 09:00:00,3960.0,4029.0,3844.0,3951.0,249,-9.0,-0.23,SPLS
2021-12-24 09:00:00,4667.0,4689.0,4384.0,4394.0,255,-273.0,-5.85,TEQA
2021-12-24 10:00:00,3872.0,3986.0,3769.0,3961.0,243,89.0,2.3,FINA
2021-12-24 10:00:00,2194.0,2314.0,2187.0,2274.0,246,80.0,3.65,FTHD
2021-12-24 10:00:00,3511.0,3554.0,3417.0,3462.0,251,-49.0,-1.4,KZNE
2021-12-24 10:00:00,3075.0,3174.0,2918.0,2928.0,251,-147.0,-4.78,NOWC
2021-12-24 10:00:00,5072.0,5088.0,4818.0,4818.0,239,-254.0,-5.01,SPCR
2021-12-24 10:00:00,3941.0,3966.0,3827.0,3918.0,249,-23.0,-0.58,SPLS
2021-12-24 10:00:00,4402.0,4413.0,4248.0,4267.0,249,-135.0,-3.07,TEQA
2021-12-24 11:00:00,3976.0,4005.0,3853.0,3922.0,261,-54.0,-1.36,FINA
2021-12-24 11:00:00,2264.0,2440.0,2162.0,2440.0,261,176.0,7.77,FTHD
2021-12-24 11:00:00,3459.0,3639.0,3359.0,3620.0,271,161.0,4.65,KZNE
2021-12-24 11:00:00,2926.0,3014.0,2886.0,2905.0,245,-21.0,-0.72,NOWC
2021-12-24 11:00:00,4811.0,4825.0,4597.0,4751.0,240,-60.0,-1.25,SPCR
2021-12-24 11:00:00,3918.0,4080.0,3871.0,4034.0,253,116.0,2.96,SPLS
2021-12-24 11:00:00,4253.0,4447.0,4246.0,4388.0,255,135.0,3.17,TEQA
2021-12-24 12:00:00,3913.0,4204.0,3902.0,4202.0,257,289.0,7.39,FINA
2021-12-24 12:00:00,2445.0,2449.0,2249.0,2412.0,253,-33.0,-1.35,FTHD
2021-12-24 12:00:00,3635.0,3656.0,3467.0,3467.0,250,-168.0,-4.62,KZNE
2021-12-24 12:00:00,2919.0,3010.0,2882.0,3006.0,241,87.0,2.98,NOWC
2021-12-24 12:00:00,4760.0,4857.0,4680.0,4844.0,253,84.0,1.76,SPCR
2021-12-24 12:00:00,4040.0,4129.0,3952.0,3954.0,261,-86.0,-2.13,SPLS
2021-12-24 12:00:00,4391.0,4410.0,4298.0,4308.0,236,-83.0,-1.89,TEQA
2021-12-24 13:00:00,4207.0,4460.0,4207.0,4424.0,234,217.0,5.16,FINA
2021-12-24 13:00:00,2418.0,2451.0,2227.0,2229.0,244,-189.0,-7.82,FTHD
2021-12-24 13:00:00,3456.0,3708.0,3311.0,3708.0,243,252.0,7.29,KZNE
2021-12-24 13:00:00,3017.0,3211.0,2994.0,3077.0,243,60.0,1.99,NOWC
2021-12-24 13:00:00,4850.0,4860.0,4595.0,4602.0,244,-248.0,-5.11,SPCR
2021-12-24 13:00:00,3952.0,3997.0,3780.0,3819.0,250,-133.0,-3.37,SPLS
2021-12-24 13:00:00,4295.0,4295.0,4176.0,4196.0,261,-99.0,-2.31,TEQA
2021-12-24 14:00:00,4434.0,4481.0,4294.0,4444.0,239,10.0,0.23,FINA
2021-12-24 14:00:00,2221.0,2238.0,1839.0,1858.0,243,-363.0,-16.34,FTHD
2021-12-24 14:00:00,3706.0,3760.0,3575.0,3650.0,242,-56.0,-1.51,KZNE
2021-12-24 14:00:00,3083.0,3168.0,2972.0,2996.0,248,-87.0,-2.82,NOWC
2021-12-24 14:00:00,4593.0,4852.0,4575.0,4761.0,244,168.0,3.66,SPCR
2021-12-24 14:00:00,3819.0,3848.0,3660.0,3829.0,252,10.0,0.26,SPLS
2021-12-24 14:00:00,4189.0,4301.0,4035.0,4151.0,249,-38.0,-0.91,TEQA
2021-12-24 15:00:00,1872.0,1872.0,1872.0,1872.0,1,0.0,0.0,FTHD
2021-12-24 15:00:00,3652.0,3652.0,3652.0,3652.0,1,0.0,0.0,KZNE
2021-12-24 15:00:00,2982.0,2982.0,2982.0,2982.0,1,0.0,0.0,NOWC
2021-12-24 15:00:00,4755.0,4755.0,4755.0,4755.0,1,0.0,0.0,SPCR
2021-12-24 15:00:00,4142.0,4142.0,4142.0,4142.0,1,0.0,0.0,TEQA
2021-12-27 09:00:00,4458.0,4499.0,4322.0,4359.0,244,-99.0,-2.22,FINA
2021-12-27 09:00:00,1880.0,2090.0,1874.0,2038.0,261,158.0,8.4,FTHD
2021-12-27 09:00:00,3656.0,3704.0,3491.0,3557.0,237,-99.0,-2.71,KZNE
2021-12-27 09:00:00,2994.0,3007.0,2846.0,2927.0,238,-67.0,-2.24,NOWC
2021-12-27 09:00:00,4767.0,4922.0,4651.0,4915.0,270,148.0,3.1,SPCR
2021-12-27 09:00:00,3828.0,3837.0,3676.0,3736.0,241,-92.0,-2.4,SPLS
2021-12-27 09:00:00,4147.0,4219.0,4052.0,4189.0,236,42.0,1.01,TEQA
2021-12-27 10:00:00,4350.0,4426.0,4277.0,4375.0,234,25.0,0.57,FINA
2021-12-27 10:00:00,2026.0,2056.0,1762.0,1765.0,250,-261.0,-12.88,FTHD
2021-12-27 10:00:00,3568.0,3818.0,3542.0,3641.0,248,73.0,2.05,KZNE
2021-12-27 10:00:00,2912.0,3002.0,2842.0,2906.0,243,-6.0,-0.21,NOWC
2021-12-27 10:00:00,4929.0,4929.0,4585.0,4747.0,263,-182.0,-3.69,SPCR
2021-12-27 10:00:00,3750.0,3787.0,3571.0,3726.0,240,-24.0,-0.64,SPLS
2021-12-27 10:00:00,4184.0,4258.0,4134.0,4198.0,258,14.0,0.33,TEQA
2021-12-27 11:00:00,4369.0,4507.0,4226.0,4493.0,256,124.0,2.84,FINA
2021-12-27 11:00:00,1778.0,1804.0,1509.0,1519.0,260,-259.0,-14.57,FTHD
2021-12-27 11:00:00,3627.0,3721.0,3594.0,3650.0,259,23.0,0.63,KZNE
2021-12-27 11:00:00,2914.0,2935.0,2713.0,2745.0,251,-169.0,-5.8,NOWC
2021-12-27 11:00:00,4747.0,4756.0,4500.0,4598.0,258,-149.0,-3.14,SPCR
2021-12-27 11:00:00,3725.0,3824.0,3619.0,3765.0,259,40.0,1.07,SPLS
2021-12-27 11:00:00,4204.0,4356.0,4123.0,4331.0,243,127.0,3.02,TEQA
2021-12-27 12:00:00,4502.0,4794.0,4492.0,4738.0,261,236.0,5.24,FINA
2021-12-27 12:00:00,1516.0,1613.0,1406.0,1586.0,265,70.0,4.62,FTHD
2021-12-27 12:00:00,3654.0,3837.0,3602.0,3795.0,236,141.0,3.86,KZNE
2021-12-27 12:00:00,2742.0,2965.0,2720.0,2856.0,251,114.0,4.16,NOWC
2021-12-27 12:00:00,4603.0,4608.0,4417.0,4511.0,264,-92.0,-2.0,SPCR
2021-12-27 12:00:00,3767.0,3965.0,3734.0,3855.0,246,88.0,2.34,SPLS
2021-12-27 12:00:00,4338.0,4378.0,4151.0,4181.0,236,-157.0,-3.62,TEQA
2021-12-27 13:00:00,4723.0,4758.0,4340.0,4340.0,239,-383.0,-8.11,FINA
2021-12-27 13:00:00,1600.0,1794.0,1587.0,1794.0,248,194.0,12.12,FTHD
2021-12-27 13:00:00,3780.0,3904.0,3770.0,3789.0,245,9.0,0.24,KZNE
2021-12-27 13:00:00,2870.0,2994.0,2762.0,2762.0,229,-108.0,-3.76,NOWC
2021-12-27 13:00:00,4496.0,4521.0,4395.0,4521.0,236,25.0,0.56,SPCR
2021-12-27 13:00:00,3845.0,3936.0,3788.0,3932.0,243,87.0,2.26,SPLS
2021-12-27 13:00:00,4187.0,4304.0,4161.0,4202.0,256,15.0,0.36,TEQA
2021-12-27 14:00:00,4346.0,4456.0,4318.0,4379.0,247,33.0,0.76,FINA
2021-12-27 14:00:00,1785.0,2143.0,1783.0,2123.0,256,338.0,18.94,FTHD
2021-12-27 14:00:00,3790.0,3791.0,3502.0,3611.0,247,-179.0,-4.72,KZNE
2021-12-27 14:00:00,2759.0,2925.0,2737.0,2836.0,250,77.0,2.79,NOWC
2021-12-27 14:00:00,4520.0,4730.0,4495.0,4670.0,248,150.0,3.32,SPCR
2021-12-27 14:00:00,3918.0,3964.0,3757.0,3764.0,247,-154.0,-3.93,SPLS
2021-12-27 14:00:00,4193.0,4201.0,3908.0,3915.0,243,-278.0,-6.63,TEQA
2021-12-27 15:00:00,4374.0,4374.0,4374.0,4374.0,1,0.0,0.0,FINA
2021-12-28 09:00:00,4377.0,4449.0,4243.0,4339.0,250,-38.0,-0.87,FINA
2021-12-28 09:00:00,2111.0,2217.0,2034.0,2153.0,248,42.0,1.99,FTHD
2021-12-28 09:00:00,3620.0,3807.0,3546.0,3628.0,246,8.0,0.22,KZNE
2021-12-28 09:00:00,2847.0,3080.0,2807.0,3045.0,257,198.0,6.95,NOWC
2021-12-28 09:00:00,4670.0,4692.0,4461.0,4588.0,250,-82.0,-1.76,SPCR
2021-12-28 09:00:00,3761.0,3829.0,3505.0,3646.0,249,-115.0,-3.06,SPLS
2021-12-28 09:00:00,3920.0,3972.0,3769.0,3895.0,242,-25.0,-0.64,TEQA
2021-12-28 10:00:00,4346.0,4514.0,4324.0,4416.0,246,70.0,1.61,FINA
2021-12-28 10:00:00,2142.0,2300.0,2101.0,2165.0,248,23.0,1.07,FTHD
2021-12-28 10:00:00,3617.0,3732.0,3494.0,3732.0,266,115.0,3.18,KZNE
2021-12-28 10:00:00,3059.0,3184.0,2983.0,2999.0,254,-60.0,-1.96,NOWC
2021-12-28 10:00:00,4583.0,4624.0,4360.0,4455.0,247,-128.0,-2.79,SPCR
2021-12-28 10:00:00,3639.0,3710.0,3548.0,3622.0,245,-17.0,-0.47,SPLS
2021-12-28 10:00:00,3906.0,3984.0,3774.0,3881.0,256,-25.0,-0.64,TEQA
2021-12-28 11:00:00,4422.0,4782.0,4386.0,4772.0,252,350.0,7.91,FINA
2021-12-28 11:00:00,2178.0,2215.0,2072.0,2135.0,229,-43.0,-1.97,FTHD
2021-12-28 11:00:00,3730.0,3833.0,3693.0,3809.0,256,79.0,2.12,KZNE
2021-12-28 11:00:00,2991.0,3020.0,2812.0,2868.0,229,-123.0,-4.11,NOWC
2021-12-28 11:00:00,4456.0,4547.0,4378.0,4529.0,255,73.0,1.64,SPCR
2021-12-28 11:00:00,3626.0,3714.0,3556.0,3714.0,261,88.0,2.43,SPLS
2021-12-28 11:00:00,3895.0,3951.0,3826.0,3934.0,249,39.0,1.0,TEQA
2021-12-28 12:00:00,4775.0,4802.0,4668.0,4773.0,239,-2.0,-0.04,FINA
2021-12-28 12:00:00,2136.0,2190.0,2009.0,2055.0,253,-81.0,-3.79,FTHD
2021-12-28 12:00:00,3803.0,3953.0,3708.0,3848.0,259,45.0,1.18,KZNE
2021-12-28 12:00:00,2878.0,2972.0,2822.0,2861.0,244,-17.0,-0.59,NOWC
2021-12-28 12:00:00,4538.0,4657.0,4485.0,4549.0,246,11.0,0.24,SPCR
2021-12-28 12:00:00,3700.0,4005.0,3651.0,3872.0,254,172.0,4.65,SPLS
2021-12-28 12:00:00,3943.0,3952.0,3741.0,3849.0,231,-94.0,-2.38,TEQA
2021-12-28 13:00:00,4774.0,4891.0,4591.0,4891.0,251,117.0,2.45,FINA
2021-12-28 13:00:00,2055.0,2354.0,2010.0,2354.0,250,299.0,14.55,FTHD
2021-12-28 13:00:00,3860.0,3875.0,3653.0,3783.0,237,-77.0,-1.99,KZNE
2021-12-28 13:00:00,2851.0,3022.0,2832.0,2976.0,261,125.0,4.38,NOWC
2021-12-28 13:00:00,4555.0,4588.0,4453.0,4558.0,252,3.0,0.07,SPCR
2021-12-28 13:00:00,3882.0,4029.0,3863.0,3887.0,243,5.0,0.13,SPLS
2021-12-28 13:00:00,3851.0,3976.0,3795.0,3918.0,248,67.0,1.74,TEQA
2021-12-28 14:00:00,4898.0,5048.0,4885.0,4930.0,264,32.0,0.65,FINA
2021-12-28 14:00:00,2361.0,2617.0,2349.0,2491.0,236,130.0,5.51,FTHD
2021-12-28 14:00:00,3776.0,4092.0,3763.0,4070.0,250,294.0,7.79,KZNE
2021-12-28 14:00:00,2974.0,3068.0,2591.0,2619.0,248,-355.0,-11.94,NOWC
2021-12-28 14:00:00,4553.0,4700.0,4535.0,4657.0,250,104.0,2.28,SPCR
2021-12-28 14:00:00,3888.0,4008.0,3804.0,3983.0,243,95.0,2.44,SPLS
2021-12-28 14:00:00,3929.0,4054.0,3847.0,3976.0,245,47.0,1.2,TEQA
"""

# DataFrameに変換
df = pd.read_csv(StringIO(ohlc_csv))


@app.put("/login", response_model=schemas.Checksum)
def login(user: schemas.Login):

    hash_obj = hashlib.new("SHA1")
    hash_obj.update((user.username+user.password).encode("utf-8"))
    digest = hash_obj.hexdigest()
    return {"token": digest}


@app.put("/flag")
def login(flag: schemas.Flag):
    print(flag.flag)
    return {"status": "ok"}

@app.get("/candle")
def login(code, year, month, day, hour):
    result = df[(df["code"] == code) & (df["time"] == "{}-{}-{} {}:00:00".format( year, month, day, hour))]
    return {"open": int(result.iloc[0].open), "high": int(result.iloc[0].high), "low": int(result.iloc[0].low), "close": int(result.iloc[0].close)}